<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>VÃ²ng quay may máº¯n</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
 font-family:Arial,Helvetica,sans-serif;
 background:#f5f5f5;
 text-align:center;
 margin:0;
}
h2{margin:20px 0}
#turnBox{
 background:#000;
 color:#00ff66;
 margin:10px auto;
 padding:12px;
 width:90%;
 max-width:360px;
 border-radius:30px;
 font-weight:bold;
}
#wheelBox{
 position:relative;
 width:300px;
 height:300px;
 margin:20px auto;
}
canvas{border-radius:50%}
#pointer{
 position:absolute;
 top:-5px;
 left:50%;
 transform:translateX(-50%);
 width:0;height:0;
 border-left:12px solid transparent;
 border-right:12px solid transparent;
 border-bottom:22px solid red;
 z-index:10;
}
button{
 background:#ee4d2d;
 color:#fff;
 border:none;
 border-radius:30px;
 padding:14px 40px;
 font-size:18px;
 cursor:pointer;
}
#popup{
 display:none;
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.6);
 justify-content:center;
 align-items:center;
}
#popup div{
 background:#fff;
 padding:25px;
 border-radius:12px;
 width:80%;
 max-width:320px;
}
</style>
</head>

<body>

<h2>VÃ²ng quay may máº¯n</h2>
<div id="turnBox">ğŸŸï¸ LÆ°á»£t cÃ²n láº¡i: <span id="turns">5</span></div>

<div id="wheelBox">
 <div id="pointer"></div>
 <canvas id="wheel" width="300" height="300"></canvas>
</div>

<button onclick="spin()">ğŸ¯ QUAY NGAY</button>

<div id="popup">
 <div>
  <h3>Káº¿t quáº£</h3>
  <p id="popupText"></p>
  <button onclick="closePopup()">OK</button>
 </div>
</div>

<script>
const prizes=[
 "Máº¥t lÆ°á»£t",
 "ThÃªm lÆ°á»£t",
 "ChÃºc may máº¯n",
 "3 giá» quÃ  Táº¿t ğŸ",
 "+50.000Ä‘",
 "+100.000Ä‘",
 "MÃ¡y sáº¥y tÃ³c ğŸ’¨",
 "Äiá»‡n thoáº¡i Samsung ğŸ“±",
 "BÃ n lÃ  ğŸ”¥"
];

let turns=5;
let spinning=false;
let rotation=0;

const canvas=document.getElementById("wheel");
const ctx=canvas.getContext("2d");
const size=prizes.length;
const slice=2*Math.PI/size;
const radius=150;

function draw(){
 ctx.clearRect(0,0,300,300);
 for(let i=0;i<size;i++){
  ctx.beginPath();
  ctx.moveTo(150,150);
  ctx.arc(150,150,150,i*slice,(i+1)*slice);
  ctx.fillStyle=i%2?"#ffe0b2":"#ffcc80";
  ctx.fill();
  ctx.save();
  ctx.translate(150,150);
  ctx.rotate(i*slice+slice/2);
  ctx.textAlign="right";
  ctx.fillStyle="#000";
  ctx.font="14px Arial";
  ctx.fillText(prizes[i],140,5);
  ctx.restore();
 }
}
draw();

function spin(){
 if(spinning||turns<=0) return;
 spinning=true;
 turns--;
 document.getElementById("turns").innerText=turns;

 let speed=0.4;
 function animate(){
  rotation+=speed;
  speed*=0.985;

  ctx.save();
  ctx.translate(150,150);
  ctx.rotate(rotation);
  ctx.translate(-150,-150);
  draw();
  ctx.restore();

  if(speed<0.002){
   spinning=false;

   // === TÃNH Ã” TRÃšNG THEO KIM ===
   let deg=(rotation*180/Math.PI)%360;
   if(deg<0) deg+=360;
   let pointerDeg=(360-deg+90)%360;
   let index=Math.floor(pointerDeg/(360/size));

   let result=prizes[index];
   document.getElementById("popupText").innerText=result;
   document.getElementById("popup").style.display="flex";

   if(result==="ThÃªm lÆ°á»£t"){
    turns++;
    document.getElementById("turns").innerText=turns;
   }
   return;
  }
  requestAnimationFrame(animate);
 }
 animate();
}

function closePopup(){
 document.getElementById("popup").style.display="none";
}
</script>

</body>
</html>
