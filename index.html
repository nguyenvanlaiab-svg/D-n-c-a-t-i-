<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V√≤ng quay may m·∫Øn</title>

<style>
    .coin {
    position: fixed;
    font-size: 26px;
    pointer-events: none;
    z-index: 9999;
    animation: coinBurst 1.5s ease-out forwards;
    filter: drop-shadow(0 0 6px gold);
}

@keyframes coinBurst {
    0% {
        transform: translate(0,0) scale(0.3) rotate(0deg);
        opacity: 0;
    }
    20% {
        opacity: 1;
    }
    100% {
        transform: translate(var(--x), var(--y)) scale(1.2) rotate(720deg);
        opacity: 0;
    }
}
body{
    margin:0;
    font-family: Arial, sans-serif;
    text-align:center;
    background:#f4f4f4;
}
h1{margin:15px 0}
.bar{
    background:#000;
    color:#00ff66;
    padding:10px;
    font-weight:bold;
}
#wrapper{
    position:relative;
    width:320px;
    height:320px;
    margin:20px auto;
}
canvas{width:100%;height:100%}
.arrow{
    position:absolute;
    top:-12px;
    left:50%;
    transform:translateX(-50%);
    width:0;
    height:0;
    border-left:12px solid transparent;
    border-right:12px solid transparent;
    border-bottom:20px solid red;
    filter: drop-shadow(0 0 6px red);
    transition: filter 0.3s;
}

.arrow.glow{
    filter:
      drop-shadow(0 0 6px gold)
      drop-shadow(0 0 12px gold)
      drop-shadow(0 0 18px orange);
}
button{
    margin-top:20px;
    background:#ff5722;
    border:none;
    color:#fff;
    padding:15px 40px;
    font-size:18px;
    border-radius:8px;
}
button:disabled{background:#aaa}
#countdown{color:red;margin-top:10px;font-weight:bold}
    #liveBox{
    margin:8px auto;
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:6px 14px;
    border-radius:20px;
    background:#000;
    color:#fff;
    font-size:14px;
    font-weight:bold;
}

.liveDot{
    color:red;
    animation: blink 1s infinite;
}

@keyframes blink{
    0%,50%,100%{opacity:1}
    25%,75%{opacity:0}
}
</style>
</head>

<body>

<h1>V√≤ng quay may m·∫Øn</h1>
    <div id="liveBox">
    <span class="liveDot">‚óè</span>
    <span id="liveText">LIVE | 61234+ ng∆∞·ªùi ƒëang ch∆°i</span>
    </div>
<div class="bar">üéüÔ∏è L∆∞·ª£t c√≤n l·∫°i: <span id="turns">0</span></div>

<div id="wrapper">
    <div class="arrow"></div>
    <canvas id="wheel" width="320" height="320"></canvas>
</div>

<button id="spinBtn">üéØ QUAY NGAY</button>
<div id="countdown"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const turnsEl = document.getElementById("turns");
const countdownEl = document.getElementById("countdown");

const MAX_TURNS = 2;
const COOLDOWN = 12 * 60 * 60 * 1000;

const prizes = [
 "M·∫•t l∆∞·ª£t",
 "Ch√∫c may m·∫Øn l·∫ßn sau",
 "+50.000ƒë",
 "+100.000ƒë",
 "+200.000ƒë",
 "+300.000ƒë",
 "+500.000ƒë",
 "-70.000ƒë",
 "-80.000ƒë",
 "-90.000ƒë",
 "-200.000ƒë",
 "Th√™m l∆∞·ª£t",
 "ƒêi·ªán tho·∫°i Samsung ‚ùå",
 "3 gi·ªè qu√† T·∫øt ‚ùå",
 "M√°y s·∫•y t√≥c ‚ùå",
 "B√†n l√† ‚ùå"
];

const blocked = [
 "ƒêi·ªán tho·∫°i Samsung ‚ùå",
 "3 gi·ªè qu√† T·∫øt ‚ùå",
 "M√°y s·∫•y t√≥c ‚ùå",
 "B√†n l√† ‚ùå"
];

const colors=[
"#95a5a6","#bdc3c7","#2ecc71","#27ae60",
"#16a085","#f1c40f","#f39c12","#e67e22",
"#d35400","#c0392b","#e74c3c","#9b59b6",
"#3498db","#1abc9c","#7f8c8d","#f7dc6f"
];

let angle=0, spinning=false;

function getData(){
    return JSON.parse(localStorage.getItem("wheelData")) || {
        turns: MAX_TURNS,
        time: 0
    };
}

function saveData(d){
    localStorage.setItem("wheelData",JSON.stringify(d));
}

function updateTurns(){
    const d = getData();
    turnsEl.innerText = d.turns;
    spinBtn.disabled = d.turns<=0;
}

function draw(){
    ctx.clearRect(0,0,320,320);
    const slice=2*Math.PI/prizes.length;
    for(let i=0;i<prizes.length;i++){
        ctx.beginPath();
        ctx.fillStyle=colors[i%colors.length];
        ctx.moveTo(160,160);
        ctx.arc(160,160,150,angle+i*slice,angle+(i+1)*slice);
        ctx.fill();

        ctx.save();
        ctx.translate(160,160);
        ctx.rotate(angle+i*slice+slice/2);
        ctx.textAlign="right";
        ctx.font="14px Arial";
        ctx.fillStyle="#000";
        ctx.fillText(prizes[i],140,5);
        ctx.restore();
    }
}
draw();

function startCountdown(){
    setInterval(()=>{
        const d=getData();
        if(d.turns>0) return;
        const remain=COOLDOWN-(Date.now()-d.time);
        if(remain<=0){
            saveData({turns:MAX_TURNS,time:0});
            countdownEl.innerText="";
            updateTurns();
            return;
        }
        const h=Math.floor(remain/3600000);
        const m=Math.floor(remain%3600000/60000);
        const s=Math.floor(remain%60000/1000);
        countdownEl.innerText=`‚è≥ Ch∆°i l·∫°i sau ${h}h ${m}m ${s}s`;
    },1000);
}

spinBtn.onclick = ()=>{
    coinEffectOnClick();        // üí• coin bay khi b·∫•m
    document.querySelector(".arrow").classList.add("glow");

    if(spinning) return;
    let d = getData();
    if(d.turns<=0) return;

    spinning = true;
    d.turns--;
    if(d.turns<=0) d.time = Date.now();
    saveData(d);
    updateTurns();

    let target;
    do{
        target = Math.floor(Math.random()*prizes.length);
    }while(blocked.includes(prizes[target]));

    const slice = 360 / prizes.length;
    const spinDeg = 360*5 + (360 - (target*slice + slice/2));

    let cur = 0;
    const timer = setInterval(()=>{
        cur += 10;
        angle += 10 * Math.PI / 180;
        draw();

        if(cur >= spinDeg){
            clearInterval(timer);
            spinning = false;

            // ‚ú® kim ph√°t s√°ng m·∫°nh khi d·ª´ng
            const arrow = document.querySelector(".arrow");
            arrow.classList.add("glow");

            // üéØ L·∫§Y K·∫æT QU·∫¢ ƒê√öNG THEO KIM
            const result = getPrizeByAngle();

            setTimeout(()=>{
                alert("üéâ B·∫°n tr√∫ng: " + result);
                arrow.classList.remove("glow");
            },300);
        }
    },20);
};

updateTurns();
startCountdown();
    function coinEffectOnClick(){
    const centerX = window.innerWidth / 2;
    const centerY = window.innerHeight / 2;

    for(let i=0;i<30;i++){
        const coin = document.createElement("div");
        coin.className = "coin";
        coin.innerText = Math.random() > 0.5 ? "ü™ô" : "üí∏";

        coin.style.left = centerX + "px";
        coin.style.top = centerY + "px";

        const x = (Math.random() - 0.5) * 400 + "px";
        const y = (Math.random() - 0.5) * 400 + "px";
        coin.style.setProperty("--x", x);
        coin.style.setProperty("--y", y);

        document.body.appendChild(coin);
        setTimeout(()=>coin.remove(),1600);
    }
            }
    function getPrizeByAngle(){
    const slice = 360 / prizes.length;

    // g√≥c kim ch·ªâ (12h)
    let deg = (360 - (angle * 180 / Math.PI) % 360 + 90) % 360;
    let index = Math.floor(deg / slice);

    return prizes[index];
    }
</script>

</body>
</html>
