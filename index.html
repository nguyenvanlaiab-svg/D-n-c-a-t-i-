<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>V√≤ng quay may m·∫Øn</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #f5f5f5;
}

#wheel-container {
  position: relative;
  width: 300px;
  margin: 40px auto;
}

#pointer {
  width: 0;
  height: 0;
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  border-bottom: 25px solid red;
  position: absolute;
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
}

canvas {
  border-radius: 50%;
  background: #fff;
}

button {
  margin-top: 20px;
  padding: 10px 25px;
  font-size: 16px;
  cursor: pointer;
}

#turns {
  margin-top: 10px;
  font-weight: bold;
}
</style>
</head>

<body>

<h2>üéØ V√≤ng Quay May M·∫Øn</h2>

<div id="wheel-container">
  <div id="pointer"></div>
  <canvas id="wheel" width="300" height="300"></canvas>
</div>

<button onclick="spin()">QUAY</button>
<div id="turns"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const prizes = [
  "Ch√∫c may m·∫Øn l·∫ßn sau",
  "üéÅ 2 gi·ªè qu√† T·∫øt",
  "‚ùå Tr∆∞·ª£t",
  "üéÅüéÅ 3 gi·ªè qu√† T·∫øt",
  "‚ùå Tr∆∞·ª£t"
];

const colors = ["#ffcc00", "#ff6666", "#cccccc", "#66cc66", "#cccccc"];
const slices = prizes.length;
const sliceAngle = 2 * Math.PI / slices;

let rotation = 0;
let spinning = false;

// ===== GI·ªöI H·∫†N 2 L∆Ø·ª¢T =====
const MAX_TURNS = 2;
let turns = localStorage.getItem("turnsUsed")
  ? parseInt(localStorage.getItem("turnsUsed"))
  : 0;

updateTurns();

// V·∫º V√íNG QUAY
function drawWheel() {
  ctx.clearRect(0, 0, 300, 300);
  for (let i = 0; i < slices; i++) {
    ctx.beginPath();
    ctx.fillStyle = colors[i];
    ctx.moveTo(150, 150);
    ctx.arc(
      150,
      150,
      150,
      i * sliceAngle + rotation,
      (i + 1) * sliceAngle + rotation
    );
    ctx.fill();

    ctx.save();
    ctx.translate(150, 150);
    ctx.rotate(i * sliceAngle + sliceAngle / 2 + rotation);
    ctx.textAlign = "right";
    ctx.fillStyle = "#000";
    ctx.font = "14px Arial";
    ctx.fillText(prizes[i], 140, 5);
    ctx.restore();
  }
}

drawWheel();

// QUAY
function spin() {
  if (spinning) return;

  if (turns >= MAX_TURNS) {
    alert("‚ùå B·∫°n ƒë√£ h·∫øt l∆∞·ª£t quay!");
    return;
  }

  turns++;
  localStorage.setItem("turnsUsed", turns);
  updateTurns();

  spinning = true;
  let spinAngle = Math.random() * 360 + 720;
  let start = rotation;
  let end = rotation + spinAngle * Math.PI / 180;
  let duration = 3000;
  let startTime = null;

  function animate(time) {
    if (!startTime) startTime = time;
    let progress = (time - startTime) / duration;

    if (progress < 1) {
      rotation = start + (end - start) * easeOut(progress);
      drawWheel();
      requestAnimationFrame(animate);
    } else {
      rotation = end;
      drawWheel();
      spinning = false;
      showResult();
    }
  }

  requestAnimationFrame(animate);
}

function easeOut(t) {
  return 1 - Math.pow(1 - t, 3);
}

// K·∫æT QU·∫¢ THEO KIM
function showResult() {
  let angle = (-rotation + Math.PI / 2) % (2 * Math.PI);
  if (angle < 0) angle += 2 * Math.PI;
  let index = Math.floor(angle / sliceAngle);
  alert("üéâ K·∫øt qu·∫£: " + prizes[index]);
}

function updateTurns() {
  document.getElementById("turns").innerText =
    "L∆∞·ª£t quay c√≤n l·∫°i: " + (MAX_TURNS - turns);
}
</script>

</body>
</html>
