<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VÃ²ng quay may máº¯n</title>
<style>
body{font-family:Arial;text-align:center;background:#f5f5f5}
#wrapper{position:relative;width:300px;height:300px;margin:20px auto}
canvas{background:#fff;border-radius:50%}
#pointer{
 position:absolute;top:-12px;left:50%;transform:translateX(-50%);
 width:0;height:0;border-left:12px solid transparent;
 border-right:12px solid transparent;border-bottom:24px solid red;
}
button{
 background:#ee4d2d;color:#fff;border:none;
 padding:12px 30px;border-radius:8px;font-size:16px
}
#info{font-weight:bold;margin:10px}
#overlay{
 position:fixed;inset:0;background:rgba(0,0,0,.5);
 display:none;justify-content:center;align-items:center
}
#popup{
 background:#fff;padding:20px;border-radius:12px;width:80%;max-width:300px
}
</style>
</head>

<body>

<h2>ðŸŽ¯ VÃ²ng quay may máº¯n</h2>
<div id="info"></div>

<div id="wrapper">
 <div id="pointer"></div>
 <canvas id="wheel" width="300" height="300"></canvas>
</div>

<button onclick="spin()">QUAY</button>

<div id="overlay">
 <div id="popup">
  <h3>Káº¿t quáº£</h3>
  <p id="result"></p>
  <button onclick="closePopup()">OK</button>
 </div>
</div>

<script>
const prizes=[
 "ChÃºc may máº¯n láº§n sau",
 "2 giá» quÃ  táº¿t",
 "TrÆ°á»£t",
 "3 giá» quÃ  táº¿t",
 "TrÆ°á»£t"
];
const colors=["#ccc","#ffca28","#b0bec5","#ff7043","#b0bec5"];

const canvas=document.getElementById("wheel");
const ctx=canvas.getContext("2d");
const center=150,radius=140;
const slice=2*Math.PI/prizes.length;

let rotation=0,spinning=false;

// ==== GIá»šI Háº N 2 LÆ¯á»¢T / 12H ====
const MAX=2, LOCK=12*60*60*1000;
let data=JSON.parse(localStorage.getItem("spinData"))||{count:0,time:0};

function updateInfo(){
 if(data.count>=MAX){
  let left=LOCK-(Date.now()-data.time);
  if(left<=0){
   data={count:0,time:0};
   localStorage.setItem("spinData",JSON.stringify(data));
  }else{
   document.getElementById("info").innerText=
    "â³ Háº¿t lÆ°á»£t â€“ quay láº¡i sau "+Math.ceil(left/3600000)+"h";
   return;
  }
 }
 document.getElementById("info").innerText=
  "ðŸŽŸï¸ LÆ°á»£t cÃ²n láº¡i: "+(MAX-data.count);
}
updateInfo();

// Váº¼ VÃ’NG
function draw(){
 ctx.clearRect(0,0,300,300);
 for(let i=0;i<prizes.length;i++){
  ctx.beginPath();
  ctx.moveTo(center,center);
  ctx.arc(center,center,radius,i*slice,(i+1)*slice);
  ctx.fillStyle=colors[i];
  ctx.fill();
  ctx.save();
  ctx.translate(center,center);
  ctx.rotate(i*slice+slice/2);
  ctx.textAlign="right";
  ctx.fillStyle="#000";
  ctx.font="14px Arial";
  ctx.fillText(prizes[i],radius-10,5);
  ctx.restore();
 }
}
draw();

function spin(){
 if(spinning) return;
 if(data.count>=MAX) return;

 spinning=true;
 data.count++;
 if(data.count===MAX) data.time=Date.now();
 localStorage.setItem("spinData",JSON.stringify(data));
 updateInfo();

 let target=rotation+Math.PI*8+Math.random()*2*Math.PI;
 let start=performance.now(),dur=3000;

 function anim(t){
  let p=Math.min((t-start)/dur,1);
  rotation+= (target-rotation)*0.08;
  ctx.setTransform(1,0,0,1,0,0);
  ctx.translate(center,center);
  ctx.rotate(rotation);
  ctx.translate(-center,-center);
  draw();
  if(p<1) requestAnimationFrame(anim);
  else{spinning=false;showResult();}
 }
 requestAnimationFrame(anim);
}

// ==== Káº¾T QUáº¢ THEO KIM 12H (CHUáº¨N) ====
function showResult(){
 let angle=(rotation+Math.PI*1.5)%(2*Math.PI);
 if(angle<0) angle+=2*Math.PI;
 let index=Math.floor(angle/slice)%prizes.length;
 document.getElementById("result").innerText=prizes[index];
 document.getElementById("overlay").style.display="flex";
}

function closePopup(){
 document.getElementById("overlay").style.display="none";
}
</script>

</body>
</html>
