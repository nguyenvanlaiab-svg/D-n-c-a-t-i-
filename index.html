<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VÃ²ng quay may máº¯n</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #f2f2f2;
}
#wheel {
  width: 300px;
  height: 300px;
  margin: 30px auto;
  border-radius: 50%;
  position: relative;
}
.pointer {
  width: 0;
  height: 0;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-bottom: 30px solid red;
  margin: auto;
}
button {
  padding: 12px 25px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: #ff5722;
  color: #fff;
}
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  display: none;
  align-items: center;
  justify-content: center;
}
.modal-content {
  background: #fff;
  padding: 25px;
  border-radius: 12px;
  width: 80%;
}
</style>
</head>

<body>

<h2>ðŸŽ¯ VÃ²ng quay may máº¯n</h2>
<p id="status">CÃ²n 5 lÆ°á»£t</p>

<div class="pointer"></div>

<canvas id="wheel" width="300" height="300"></canvas>

<button onclick="spin()">QUAY</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Káº¿t quáº£</h3>
    <p id="result"></p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
const prizes = [
  "TrÆ°á»£t",
  "ChÃºc may máº¯n láº§n sau",
  "2 giá» quÃ  táº¿t",
  "Máº¥t lÆ°á»£t",
  "ThÃªm lÆ°á»£t"
];

const colors = ["#607d8b","#9e9e9e","#c9a227","#e57373","#81c784"];

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const cx = canvas.width/2;
const cy = canvas.height/2;
const radius = 140;
const slice = 2 * Math.PI / prizes.length;

let rotation = 0;
let spinning = false;

let data = JSON.parse(localStorage.getItem("spinData")) || {
  turns: 5,
  lock: 0
};

function drawWheel() {
  ctx.clearRect(0,0,300,300);
  prizes.forEach((text,i)=>{
    const start = i * slice;
    const end = start + slice;

    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,radius,start,end);
    ctx.fillStyle = colors[i];
    ctx.fill();

    // TEXT â€“ KHÃ”NG Lá»†CH
    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(start + slice/2);
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "#000";
    ctx.font = "14px Arial";
    ctx.fillText(text, radius - 55, 0);
    ctx.restore();
  });
}
drawWheel();

function spin() {
  if (spinning) return;

  const now = Date.now();
  if (data.lock > now) {
    alert("Háº¿t lÆ°á»£t â€“ quay láº¡i sau 12h");
    return;
  }

  if (data.turns <= 0) {
    data.lock = now + 12*60*60*1000;
    localStorage.setItem("spinData", JSON.stringify(data));
    alert("Háº¿t lÆ°á»£t â€“ khÃ³a 12h");
    return;
  }

  data.turns--;
  document.getElementById("status").innerText = "CÃ²n " + data.turns + " lÆ°á»£t";
  localStorage.setItem("spinData", JSON.stringify(data));

  spinning = true;
  const rand = Math.random() * 360 + 360*5;

  let start = null;
  function animate(t){
    if(!start) start = t;
    const p = Math.min((t-start)/3000,1);
    const ease = 1 - Math.pow(1-p,3);
    rotation = rand * ease;
    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(rotation*Math.PI/180);
    ctx.translate(-cx,-cy);
    drawWheel();
    ctx.restore();
    if(p<1) requestAnimationFrame(animate);
    else finish();
  }
  requestAnimationFrame(animate);
}

function finish(){
  spinning = false;
  const deg = (360 - rotation%360 + 270) % 360;
  const index = Math.floor(deg / (360/prizes.length));
  document.getElementById("result").innerText = prizes[index];
  document.getElementById("modal").style.display="flex";
}

function closeModal(){
  document.getElementById("modal").style.display="none";
}
</script>

</body>
</html>
